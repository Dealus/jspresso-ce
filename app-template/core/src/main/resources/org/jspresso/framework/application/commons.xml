<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.5.xsd"
  default-lazy-init="true">

  <!-- Root application context for the Jspresso framework. -->

  <bean id="mockMessageSource" class="org.jspresso.framework.util.i18n.mock.MockMessageSource" />

  <bean id="translationProvider" class="org.jspresso.framework.util.i18n.basic.MessageSourceTranslationProvider">
    <property name="messageSource" ref="applicationMessageSource" />
  </bean>

  <bean id="commonsMessageSource" class="org.jspresso.framework.util.i18n.EnhancedResourceBundleMessageSource">
    <property name="parentMessageSource" ref="mockMessageSource" />
    <property name="basename" value="org.jspresso.framework.application.i18n.Commons" />
    <property name="resolveNested" value="false" />
  </bean>

  <bean id="abstractApplicationMessageSource" abstract="true"
    class="org.jspresso.framework.util.i18n.EnhancedResourceBundleMessageSource" />

  <!-- The implementation used as MvcBinder. -->
  <bean id="mvcBinder" class="org.jspresso.framework.binding.DefaultMvcBinder" />

  <!-- The implementation used as factories. -->
  <bean id="accessorFactory" class="org.jspresso.framework.util.accessor.basic.BasicAccessorFactory">
    <property name="beanAccessorFactory">
      <bean class="org.jspresso.framework.util.accessor.bean.BeanAccessorFactory" />
    </property>
    <property name="mapAccessorFactory">
      <bean class="org.jspresso.framework.model.map.DescriptorAwareMapAccessorFactory" />
    </property>
  </bean>

  <bean id="reportFactory" class="org.jspresso.framework.application.printing.model.basic.BasicReportFactory" />

  <!-- The implementation used as ComponentCollectionFactory. -->
  <bean id="componentCollectionFactory" class="org.jspresso.framework.model.component.DefaultComponentCollectionFactory" />

  <!-- The implementation used as ModelConnectorFactory. -->
  <bean id="modelConnectorFactory" class="org.jspresso.framework.binding.model.DefaultModelConnectorFactory">
    <property name="accessorFactory" ref="accessorFactory" />
    <property name="descriptorRegistry" ref="componentDescriptorRegistry" />
  </bean>

  <!-- The implementation used as MvcBinder. -->
  <bean id="modelCascadingBinder" class="org.jspresso.framework.binding.masterdetail.DefaultModelCascadingBinder">
    <property name="mvcBinder" ref="mvcBinder" />
  </bean>

  <!-- The GUID generator used to implement entities "synthetic key". The idea was taken from 'maulinshah' post on the hibernate 
    wiki. The implementation of the GUID generator has been written by Marc A. Mnich who published it on http://www.javaexchange.com/aboutRandomGUID.html -->
  <bean id="entityGUIDGenerator" class="org.jspresso.framework.util.uid.RandomGUIDGenerator" />

  <bean id="guidGenerator" class="org.jspresso.framework.util.uid.JVMGUIDGenerator" scope="prototype" />

  <!-- The root abstract implementation used as Application Session. -->
  <bean id="applicationSession" scope="prototype"
    class="org.jspresso.framework.application.backend.session.basic.BasicApplicationSession" />

  <!-- The implementation used as ComponentDescriptorRegistry. -->
  <bean id="componentDescriptorRegistry" class="org.jspresso.framework.model.descriptor.basic.BasicComponentDescriptorRegistry" />

  <!-- The implementation used as ComponentIconImageURLProvider. -->
  <bean id="defaultDomainImageUrlProvider" class="org.jspresso.framework.model.descriptor.ComponentIconImageURLProvider">
    <property name="componentDescriptorRegistry" ref="componentDescriptorRegistry" />
  </bean>

  <!-- The implementation used as ComponentFactory. -->
  <bean id="queryComponentDescriptorFactory" class="org.jspresso.framework.model.descriptor.basic.BasicQueryComponentDescriptorFactory" />
  <bean id="componentExtensionFactory" class="org.jspresso.framework.model.component.DefaultComponentExtensionFactory" />

  <bean id="basicComponentFactory" class="org.jspresso.framework.model.component.basic.BasicProxyComponentFactory">
    <property name="accessorFactory" ref="accessorFactory" />
    <property name="componentCollectionFactory" ref="componentCollectionFactory" />
    <property name="componentExtensionFactory" ref="componentExtensionFactory" />
    <property name="componentDescriptorRegistry" ref="componentDescriptorRegistry" />
    <property name="queryComponentDescriptorFactory" ref="queryComponentDescriptorFactory" />
  </bean>

  <!-- The implementation used as EntityFactory. -->
  <bean id="basicEntityFactory" class="org.jspresso.framework.model.entity.basic.BasicProxyEntityFactory">
    <property name="accessorFactory" ref="accessorFactory" />
    <property name="inlineComponentFactory" ref="basicComponentFactory" />
    <property name="entityCollectionFactory" ref="componentCollectionFactory" />
    <property name="entityExtensionFactory" ref="componentExtensionFactory" />
    <property name="entityGUIDGenerator" ref="entityGUIDGenerator" />
  </bean>

  <bean id="sessionAwareComponentFactory" parent="basicComponentFactory"
    class="org.jspresso.framework.application.backend.component.ControllerAwareProxyComponentFactory" scope="prototype">
  </bean>

  <bean id="sessionAwareEntityFactory" parent="basicEntityFactory"
    class="org.jspresso.framework.application.backend.entity.ControllerAwareProxyEntityFactory" scope="prototype">
    <property name="inlineComponentFactory" ref="sessionAwareComponentFactory" />
  </bean>
  <!-- Root action beans. -->

  <bean id="createQueryComponentAction" class="org.jspresso.framework.application.backend.action.CreateQueryComponentAction">
    <property name="queryComponentDescriptorFactory" ref="queryComponentDescriptorFactory" />
  </bean>

  <bean id="initModuleFilterAction" class="org.jspresso.framework.application.backend.action.module.InitModuleFilterAction" />

  <!-- The implementation used as view factory. View factory is not defined as singleton since it can implement some cache 
    a the session level. -->
  <bean id="abstractViewFactory" class="org.jspresso.framework.view.AbstractViewFactory" abstract="true">
    <property name="connectorFactory" ref="connectorFactory" />
    <property name="modelConnectorFactory" ref="modelConnectorFactory" />
    <property name="mvcBinder" ref="mvcBinder" />
    <property name="translationProvider" ref="translationProvider" />
    <property name="modelCascadingBinder" ref="modelCascadingBinder" />
    <property name="iconFactory" ref="iconFactory" />
    <property name="actionFactory" ref="actionFactory" />
    <property name="lovAction" ref="lovAction" />
    <property name="openFileAsBinaryPropertyAction" ref="openFileAsBinaryPropertyAction" />
    <property name="saveBinaryPropertyAsFileAction" ref="saveBinaryPropertyAsFileAction" />
    <property name="resetPropertyAction" ref="resetPropertyFrontAction" />
    <property name="binaryPropertyInfoAction" ref="binaryPropertyInfoAction" />
  </bean>

  <bean id="viewFactoryBase" parent="abstractViewFactory" abstract="true" />

  <bean id="abstractActionFactory" abstract="true">
    <property name="translationProvider" ref="translationProvider" />
    <property name="iconFactory" ref="iconFactory" />
  </bean>

  <bean id="actionFactoryBase" parent="abstractActionFactory" abstract="true" />

  <!-- The scriptHandler. -->
  <bean id="scriptHandler" class="org.jspresso.framework.util.scripting.DefaultScriptHandler" />

  <!-- The query view descriptor factory. -->
  <bean id="queryViewDescriptorFactory" class="org.jspresso.framework.view.descriptor.basic.BasicQueryViewDescriptorFactory">
    <property name="queryComponentDescriptorFactory" ref="queryComponentDescriptorFactory" />
  </bean>

  <!-- Custom exception handler -->
  <bean id="customExceptionHandler" class="org.jspresso.framework.util.exception.MockExceptionHandler"/>

  <!-- Security plugin -->
  <bean id="customSecurityPlugin" class="org.jspresso.framework.security.MockSecurityPlugin"/>
  
  <!-- User preference store -->
  <bean id="userPreferenceStore" class="org.jspresso.framework.util.preferences.MockPreferenceStore"/>

  <!-- The controllers. -->

  <!-- The controllers. Controllers are not singleton since they can hold some session state. -->
  <bean abstract="true" id="abstractFrontControllerBase" class="org.jspresso.framework.application.frontend.controller.AbstractFrontendController">
    <property name="mvcBinder" ref="mvcBinder" />
    <property name="translationProvider" ref="translationProvider" />
    <property name="viewFactory" ref="viewFactory" />
    <property name="workspacesMenuIconImageUrl" value="classpath:org/jspresso/framework/application/images/workspaces-48x48.png" />
    <property name="loginViewDescriptor" ref="loginViewDescriptor" />
    <property name="navigationActionMap" ref="moduleHistoryNavigationActionMap" />
    <property name="onModuleExitAction" ref="checkAllModulesDirtyStateFrontAction" />
    <property name="exitAction" ref="exitFrontAction" />
    <property name="customSecurityPlugin" ref="customSecurityPlugin"/>
    <property name="customExceptionHandler" ref="customExceptionHandler"/>
  </bean>

  <bean abstract="true" id="abstractFrontController" parent="abstractFrontControllerBase"/>

  <bean abstract="true" id="abstractIconFactory" class="org.jspresso.framework.view.AbstractIconFactory">
    <property name="okYesIconImageURL" value="classpath:org/jspresso/framework/application/images/ok-48x48.png" />
    <property name="noIconImageURL" value="classpath:org/jspresso/framework/application/images/no-48x48.png" />
    <property name="cancelIconImageURL" value="classpath:org/jspresso/framework/application/images/cancel-48x48.png" />
    <property name="infoIconImageURL" value="classpath:org/jspresso/framework/application/images/info-48x48.png" />
    <property name="warningIconImageURL" value="classpath:org/jspresso/framework/application/images/warning-48x48.png" />
    <property name="questionIconImageURL" value="classpath:org/jspresso/framework/application/images/question-48x48.png" />
    <property name="errorIconImageURL" value="classpath:org/jspresso/framework/application/images/error-48x48.png" />
    <property name="forbiddenIconImageURL" value="classpath:org/jspresso/framework/application/images/forbidden-48x48.png" />
    <property name="backwardIconImageURL" value="classpath:org/jspresso/framework/application/images/backward-48x48.png" />
    <property name="forwardIconImageURL" value="classpath:org/jspresso/framework/application/images/forward-48x48.png" />
    <property name="upIconImageURL" value="classpath:org/jspresso/framework/application/images/1uparrow-48x48.png" />
    <property name="downIconImageURL" value="classpath:org/jspresso/framework/application/images/1downarrow-48x48.png" />
  </bean>

  <bean id="iconFactoryBase" parent="abstractIconFactory" abstract="true" />



  <bean abstract="true" id="abstractBackControllerBase" class="org.jspresso.framework.application.backend.AbstractBackendController">
    <property name="entityFactory" ref="sessionAwareEntityFactory" />
    <property name="modelConnectorFactory" ref="modelConnectorFactory" />
    <property name="translationProvider" ref="translationProvider" />
    <property name="applicationSession" ref="applicationSession" />
    <property name="collectionFactory" ref="componentCollectionFactory" />
    <property name="entityRegistry">
      <bean class="org.jspresso.framework.model.entity.basic.BasicEntityRegistry" />
    </property>
    <property name="unitOfWork">
      <bean class="org.jspresso.framework.application.backend.session.basic.BasicEntityUnitOfWork" />
    </property>
    <property name="carbonEntityCloneFactory">
      <bean class="org.jspresso.framework.model.entity.CarbonEntityCloneFactory" />
    </property>
    <property name="transactionTemplate" ref="transactionTemplate" />
    <property name="customSecurityPlugin" ref="customSecurityPlugin"/>
    <property name="customExceptionHandler" ref="customExceptionHandler"/>
    <property name="userPreferenceStore" ref="userPreferenceStore"/>
  </bean>

  <bean abstract="true" id="abstractBackController" parent="abstractBackControllerBase"/>

  <!-- Utility beans for model. -->
  <bean id="BasicReportDescriptor_INSTANCE" class="org.springframework.beans.factory.config.FieldRetrievingFactoryBean">
    <property name="staticField">
      <value>
        org.jspresso.framework.application.printing.model.descriptor.basic.BasicReportDescriptor.INSTANCE
      </value>
    </property>
  </bean>

  <!-- Utility beans for views. -->
  <bean id="decoratedView" abstract="true">
    <property name="borderType" value="TITLED" />
  </bean>

  <!-- Backend action beans -->
  <bean id="jdbcTemplate" class="org.springframework.jdbc.core.JdbcTemplate">
    <property name="dataSource" ref="dataSource" />
  </bean>

  <bean id="reportingJdbcTemplate" class="org.springframework.jdbc.core.JdbcTemplate">
    <property name="dataSource" ref="dataSource" />
  </bean>

  <bean id="doPrintBackendAction" class="org.jspresso.framework.application.printing.backend.action.GenerateJasperReportAction">
    <property name="jdbcTemplate" ref="reportingJdbcTemplate" />
  </bean>

  <bean id="abstractBackendAction" abstract="true" class="org.jspresso.framework.application.backend.action.BackendAction" />
    
</beans>
