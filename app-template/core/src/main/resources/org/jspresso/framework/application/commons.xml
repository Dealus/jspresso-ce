<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd"
  default-lazy-init="true">

  <!-- Root application context for the Jspresso framework. -->

  <bean id="mockMessageSource" class="org.jspresso.framework.util.i18n.mock.MockMessageSource" />

  <bean id="translationProvider" class="org.jspresso.framework.util.i18n.basic.MessageSourceTranslationProvider">
    <property name="messageSource" ref="applicationMessageSource" />
  </bean>

  <bean id="commonsMessageSource" class="org.jspresso.framework.util.i18n.EnhancedResourceBundleMessageSource">
    <property name="parentMessageSource" ref="mockMessageSource" />
    <property name="basenames">
      <list>
        <value>org.jspresso.framework.application.i18n.Formats</value>
        <value>org.jspresso.framework.application.i18n.Commons</value>
      </list>
    </property>
    <property name="resolveNested" value="false" />
  </bean>

  <bean id="abstractApplicationMessageSource" abstract="true"
    class="org.jspresso.framework.util.i18n.EnhancedResourceBundleMessageSource" />

  <!-- The implementation used as MvcBinder. -->
  <bean id="mvcBinder" class="org.jspresso.framework.binding.DefaultMvcBinder" />

  <!-- The implementation used as factories. -->
  <bean id="accessorFactory" class="org.jspresso.framework.util.accessor.basic.BasicAccessorFactory">
    <property name="beanAccessorFactory">
      <bean class="org.jspresso.framework.util.accessor.bean.BeanAccessorFactory" />
    </property>
    <property name="mapAccessorFactory">
      <bean class="org.jspresso.framework.model.map.DescriptorAwareMapAccessorFactory" />
    </property>
  </bean>

  <bean id="reportFactory" class="org.jspresso.framework.application.printing.model.basic.BasicReportFactory" />

  <!-- The implementation used as ComponentCollectionFactory. -->
  <bean id="componentCollectionFactory" class="org.jspresso.framework.model.component.DefaultComponentCollectionFactory" />

  <!-- The implementation used as ModelConnectorFactory. -->
  <bean id="modelConnectorFactory" class="org.jspresso.framework.binding.model.DefaultModelConnectorFactory">
    <property name="accessorFactory" ref="accessorFactory" />
    <property name="descriptorRegistry" ref="componentDescriptorRegistry" />
  </bean>

  <!-- The implementation used as MvcBinder. -->
  <bean id="modelCascadingBinder" class="org.jspresso.framework.binding.masterdetail.DefaultModelCascadingBinder">
    <property name="mvcBinder" ref="mvcBinder" />
  </bean>

  <bean id="stringGUIDGenerator" class="org.jspresso.framework.util.uid.RandomGUIDGenerator" />
  <bean id="binaryGUIDGenerator" class="org.jspresso.framework.util.uid.RandomBinaryGUIDGenerator" />
  <bean id="entityGUIDGenerator" parent="stringGUIDGenerator"/>

  <bean id="guidGenerator" class="org.jspresso.framework.util.uid.JVMGUIDGenerator" scope="prototype" />

  <!-- The root abstract implementation used as Application Session. -->
  <bean id="applicationSession" scope="prototype"
    class="org.jspresso.framework.application.backend.session.basic.BasicApplicationSession" />

  <!-- The implementation used as ComponentDescriptorRegistry. -->
  <bean id="componentDescriptorRegistry" class="org.jspresso.framework.model.descriptor.basic.BasicComponentDescriptorRegistry" />

  <!-- The implementation used as ComponentIconImageURLProvider. -->
  <bean id="defaultDomainImageUrlProvider" class="org.jspresso.framework.model.descriptor.ComponentIconImageURLProvider">
    <property name="componentDescriptorRegistry" ref="componentDescriptorRegistry" />
  </bean>

  <!-- The implementation used as ComponentFactory. -->
  <bean id="queryComponentDescriptorFactory" class="org.jspresso.framework.model.descriptor.basic.BasicQueryComponentDescriptorFactory" />
  <bean id="componentExtensionFactory" class="org.jspresso.framework.model.component.DefaultComponentExtensionFactory" />

  <bean id="basicComponentFactory" class="org.jspresso.framework.model.component.basic.BasicProxyComponentFactory">
    <property name="accessorFactory" ref="accessorFactory" />
    <property name="componentCollectionFactory" ref="componentCollectionFactory" />
    <property name="componentExtensionFactory" ref="componentExtensionFactory" />
    <property name="componentDescriptorRegistry" ref="componentDescriptorRegistry" />
    <property name="queryComponentDescriptorFactory" ref="queryComponentDescriptorFactory" />
  </bean>

  <!-- The implementation used as EntityFactory. -->
  <bean id="basicEntityFactory" class="org.jspresso.framework.model.entity.basic.BasicProxyEntityFactory">
    <property name="accessorFactory" ref="accessorFactory" />
    <property name="inlineComponentFactory" ref="basicComponentFactory" />
    <property name="entityCollectionFactory" ref="componentCollectionFactory" />
    <property name="entityExtensionFactory" ref="componentExtensionFactory" />
    <property name="entityGUIDGenerator" ref="entityGUIDGenerator" />
  </bean>

  <bean id="sessionAwareComponentFactory" parent="basicComponentFactory"
    class="org.jspresso.framework.application.backend.component.ControllerAwareProxyComponentFactory" scope="prototype">
  </bean>

  <bean id="sessionAwareEntityFactory" parent="basicEntityFactory"
    class="org.jspresso.framework.application.backend.entity.ControllerAwareProxyEntityFactory" scope="prototype">
    <property name="inlineComponentFactory" ref="sessionAwareComponentFactory" />
  </bean>
  <!-- Root action beans. -->

  <bean id="applicationQueryComponentRefiner" class="org.jspresso.framework.application.backend.action.MockQueryComponentRefiner" />

  <bean id="createQueryComponentActionBase" class="org.jspresso.framework.application.backend.action.CreateQueryComponentAction">
    <property name="queryComponentDescriptorFactory" ref="queryComponentDescriptorFactory" />
    <property name="queryComponentRefiner" ref="applicationQueryComponentRefiner" />
  </bean>

  <bean id="createQueryComponentAction" parent="createQueryComponentActionBase" />

  <bean id="initModuleFilterActionBase" class="org.jspresso.framework.application.backend.action.module.InitModuleFilterAction">
    <property name="createQueryComponentAction" ref="createQueryComponentAction" />
  </bean>

  <bean id="initModuleFilterAction" parent="initModuleFilterActionBase" />

  <!-- The implementation used as view factory. View factory is not defined as singleton since it can implement some cache 
    a the session level. -->
  <bean id="abstractViewFactory" class="org.jspresso.framework.view.AbstractViewFactory" abstract="true">
    <property name="connectorFactory" ref="connectorFactory" />
    <property name="modelConnectorFactory" ref="modelConnectorFactory" />
    <property name="mvcBinder" ref="mvcBinder" />
    <property name="modelCascadingBinder" ref="modelCascadingBinder" />
    <property name="iconFactory" ref="iconFactory" />
    <property name="actionFactory" ref="actionFactory" />
    <property name="lovAction" ref="lovAction" />
    <property name="openFileAsBinaryPropertyAction" ref="openFileAsBinaryPropertyAction" />
    <property name="saveBinaryPropertyAsFileAction" ref="saveBinaryPropertyAsFileAction" />
    <property name="resetPropertyAction" ref="resetPropertyFrontAction" />
    <property name="binaryPropertyInfoAction" ref="binaryPropertyInfoAction" />
  </bean>

  <bean id="viewFactoryBase" parent="abstractViewFactory" abstract="true" />

  <bean id="abstractActionFactory" abstract="true" class="org.jspresso.framework.view.AbstractActionFactory">
    <property name="iconFactory" ref="iconFactory" />
  </bean>

  <bean id="actionFactoryBase" parent="abstractActionFactory" abstract="true" />

  <!-- The scriptHandler. -->
  <bean id="scriptHandler" class="org.jspresso.framework.util.scripting.DefaultScriptHandler" />

  <!-- The query view descriptor factory. -->
  <bean id="queryViewDescriptorFactory" class="org.jspresso.framework.view.descriptor.basic.BasicQueryViewDescriptorFactory">
    <property name="queryComponentDescriptorFactory" ref="queryComponentDescriptorFactory" />
  </bean>

  <!-- Custom exception handler -->
  <bean id="customExceptionHandler" class="org.jspresso.framework.util.exception.MockExceptionHandler" />

  <!-- Security plugin -->
  <bean id="customSecurityPlugin" class="org.jspresso.framework.application.security.MockSecurityPlugin" />

  <!-- Translation plugin -->
  <bean id="customTranslationPlugin" class="org.jspresso.framework.application.i18n.MockTranslationPlugin" />

  <!-- User preference store -->
  <bean id="userPreferencesStore" class="org.jspresso.framework.util.preferences.MockPreferencesStore" />

  <!-- The controllers. -->

  <!-- The controllers. Controllers are not singleton since they can hold some session state. -->
  <bean abstract="true" id="abstractFrontControllerBase" class="org.jspresso.framework.application.frontend.controller.AbstractFrontendController">
    <property name="mvcBinder" ref="mvcBinder" />
    <property name="viewFactory" ref="viewFactory" />
    <property name="workspacesMenuIconImageUrl" value="classpath:org/jspresso/framework/application/images/workspaces-48x48.png" />
    <property name="loginViewDescriptor" ref="loginViewDescriptor" />
    <property name="navigationActionMap" ref="moduleHistoryNavigationActionMap" />
    <property name="onModuleExitAction" ref="checkAllModulesDirtyStateFrontAction" />
    <property name="exitAction" ref="exitFrontAction" />
    <property name="customExceptionHandler" ref="customExceptionHandler" />
  </bean>

  <bean abstract="true" id="abstractFrontController" parent="abstractFrontControllerBase" />

  <bean abstract="true" id="abstractIconFactory" class="org.jspresso.framework.view.AbstractIconFactory">
    <property name="okYesIconImageURL" value="classpath:org/jspresso/framework/application/images/ok-48x48.png" />
    <property name="noIconImageURL" value="classpath:org/jspresso/framework/application/images/no-48x48.png" />
    <property name="cancelIconImageURL" value="classpath:org/jspresso/framework/application/images/cancel-48x48.png" />
    <property name="infoIconImageURL" value="classpath:org/jspresso/framework/application/images/info-48x48.png" />
    <property name="warningIconImageURL" value="classpath:org/jspresso/framework/application/images/warning-48x48.png" />
    <property name="questionIconImageURL" value="classpath:org/jspresso/framework/application/images/question-48x48.png" />
    <property name="errorIconImageURL" value="classpath:org/jspresso/framework/application/images/error-48x48.png" />
    <property name="forbiddenIconImageURL" value="classpath:org/jspresso/framework/application/images/forbidden-48x48.png" />
    <property name="backwardIconImageURL" value="classpath:org/jspresso/framework/application/images/backward-48x48.png" />
    <property name="forwardIconImageURL" value="classpath:org/jspresso/framework/application/images/forward-48x48.png" />
    <property name="upIconImageURL" value="classpath:org/jspresso/framework/application/images/1uparrow-48x48.png" />
    <property name="downIconImageURL" value="classpath:org/jspresso/framework/application/images/1downarrow-48x48.png" />
  </bean>

  <bean id="iconFactoryBase" parent="abstractIconFactory" abstract="true" />



  <bean abstract="true" id="abstractBackControllerBase" class="org.jspresso.framework.application.backend.AbstractBackendController">
    <property name="entityFactory" ref="sessionAwareEntityFactory" />
    <property name="modelConnectorFactory" ref="modelConnectorFactory" />
    <property name="translationProvider" ref="translationProvider" />
    <property name="applicationSession" ref="applicationSession" />
    <property name="collectionFactory" ref="componentCollectionFactory" />
    <property name="entityRegistry">
      <bean class="org.jspresso.framework.model.entity.basic.BasicEntityRegistry" />
    </property>
    <property name="unitOfWork">
      <bean class="org.jspresso.framework.application.backend.session.basic.BasicEntityUnitOfWork" />
    </property>
    <property name="carbonEntityCloneFactory">
      <bean class="org.jspresso.framework.model.entity.CarbonEntityCloneFactory" />
    </property>
    <property name="transactionTemplate" ref="transactionTemplate" />
    <property name="customSecurityPlugin" ref="customSecurityPlugin" />
    <property name="customTranslationPlugin" ref="customTranslationPlugin" />
    <property name="customExceptionHandler" ref="customExceptionHandler" />
    <property name="userPreferencesStore" ref="userPreferencesStore" />
  </bean>

  <bean abstract="true" id="abstractBackController" parent="abstractBackControllerBase" />

  <!-- Utility beans for model. -->
  <bean id="BasicReportDescriptor_INSTANCE" class="org.springframework.beans.factory.config.FieldRetrievingFactoryBean">
    <property name="staticField">
      <value>
        org.jspresso.framework.application.printing.model.descriptor.basic.BasicReportDescriptor.INSTANCE
      </value>
    </property>
  </bean>

  <!-- Utility beans for views. -->
  <bean id="decoratedView" abstract="true">
    <property name="borderType" value="TITLED" />
  </bean>

  <!-- Backend action beans -->
  <bean id="jdbcTemplate" class="org.springframework.jdbc.core.JdbcTemplate">
    <property name="dataSource" ref="dataSource" />
  </bean>

  <bean id="reportingJdbcTemplate" class="org.springframework.jdbc.core.JdbcTemplate">
    <property name="dataSource" ref="dataSource" />
  </bean>

  <bean id="doPrintBackendAction" class="org.jspresso.framework.application.printing.backend.action.GenerateJasperReportAction">
    <property name="jdbcTemplate" ref="reportingJdbcTemplate" />
  </bean>

  <bean id="abstractBackendAction" abstract="true" class="org.jspresso.framework.application.backend.action.BackendAction" />

  <bean id="lovFindBackAction" class="org.jspresso.framework.application.backend.action.FindAction">
    <property name="queryAction">
      <bean parent="queryEntitiesBackAction">
        <property name="mergeMode">
          <null />
        </property>
      </bean>
    </property>
  </bean>

  <bean id="changePasswordBackAction" class="org.jspresso.framework.application.backend.action.BackendAction" />

  <bean id="queryModuleFilterBackAction" class="org.jspresso.framework.application.backend.action.module.QueryModuleFilterAction">
    <property name="queryAction" ref="queryEntitiesBackAction" />
  </bean>

  <bean id="scriptedBackAction" class="org.jspresso.framework.application.backend.action.ScriptedBackendAction">
    <property name="scriptHandler" ref="scriptHandler" />
  </bean>

  <bean id="staticScriptedBackAction" abstract="true" parent="scriptedBackAction"
    class="org.jspresso.framework.application.backend.action.StaticScriptedBackendAction" />

  <bean id="pasteCollectionBackAction" class="org.jspresso.framework.application.backend.action.PasteCollectionToMasterAction">
    <property name="entityCloneFactory" ref="smartEntityCloneFactory" />
  </bean>

  <bean id="rootEntityId" class="org.jspresso.framework.model.descriptor.basic.BasicJavaSerializablePropertyDescriptor">
    <property name="name" value="id" />
    <property name="maxLength" value="36" />
  </bean>

  <bean id="rootEntityVersion" class="org.jspresso.framework.model.descriptor.basic.BasicIntegerPropertyDescriptor">
    <property name="name" value="version" />
  </bean>

  <bean id="rootEntityDescriptor" class="org.jspresso.framework.model.descriptor.basic.BasicInterfaceDescriptor">
    <constructor-arg value="org.jspresso.framework.model.entity.IEntity" />
    <property name="propertyDescriptors">
      <list>
        <bean parent="rootEntityId">
          <property name="readOnly" value="true" />
        </bean>
        <bean parent="rootEntityVersion">
          <property name="readOnly" value="true" />
        </bean>
        <bean class="org.jspresso.framework.model.descriptor.basic.BasicBooleanPropertyDescriptor">
          <property name="name" value="persistent" />
          <property name="readOnly" value="true" />
          <property name="computed" value="true" />
        </bean>
      </list>
    </property>
    <property name="renderedProperties">
      <list />
    </property>
    <property name="queryableProperties">
      <list />
    </property>
  </bean>

  <bean id="EnityDescriptorInit" class="org.springframework.beans.factory.config.MethodInvokingFactoryBean">
    <property name="targetClass" value="org.jspresso.framework.model.descriptor.entity.basic.BasicEntityDescriptor" />
    <property name="targetMethod" value="setRootEntityDescriptor" />
    <property name="arguments">
      <list>
        <ref bean="rootEntityDescriptor" />
      </list>
    </property>
  </bean>
</beans>
