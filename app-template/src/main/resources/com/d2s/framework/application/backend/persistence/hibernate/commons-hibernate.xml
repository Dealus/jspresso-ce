<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN//EN" "http://www.springframework.org/dtd/spring-beans.dtd">

<!--
	Hibernate root application context for the D2S framework.
-->
<beans default-lazy-init="true">

	<bean id="applicationSession" parent="abstractApplicationSession"
		class="com.d2s.framework.application.backend.session.hibernate.HibernateAwareApplicationSession">
		<property name="hibernateTemplate" ref="hibernateTemplate" />
	</bean>

	<!--
		Hibernate persisters configuration.
	-->
	<bean class="org.springframework.beans.factory.config.MethodInvokingFactoryBean">
		<property name="targetClass"
			value="com.d2s.framework.model.persistence.hibernate.entity.persister.EntityProxySingleTableEntityPersister" />
		<property name="targetMethod">
			<value>setEntityFactory</value>
		</property>
		<property name="arguments">
			<list>
				<ref bean="entityFactory" />
			</list>
		</property>
	</bean>

	<bean class="org.springframework.beans.factory.config.MethodInvokingFactoryBean">
		<property name="targetClass"
			value="com.d2s.framework.model.persistence.hibernate.entity.persister.EntityProxyJoinedSubclassEntityPersister" />
		<property name="targetMethod">
			<value>setEntityFactory</value>
		</property>
		<property name="arguments">
			<list>
				<ref bean="entityFactory" />
			</list>
		</property>
	</bean>

	<bean class="org.springframework.beans.factory.config.MethodInvokingFactoryBean">
		<property name="targetClass"
			value="com.d2s.framework.model.persistence.hibernate.entity.persister.EntityProxyUnionSubclassEntityPersister" />
		<property name="targetMethod">
			<value>setEntityFactory</value>
		</property>
		<property name="arguments">
			<list>
				<ref bean="entityFactory" />
			</list>
		</property>
	</bean>

	<bean id="proxyEntityInterceptor"
		class="com.d2s.framework.application.backend.persistence.hibernate.ApplicationSessionAwareEntityProxyInterceptor">
		<property name="entityFactory" ref="entityFactory" />
		<property name="applicationSession" ref="applicationSession" />
	</bean>

	<bean id="abstractHibernateSessionFactory" class="org.springframework.orm.hibernate3.LocalSessionFactoryBean">
		<property name="dataSource" ref="dataSource" />
		<property name="entityInterceptor" ref="proxyEntityInterceptor" />
	</bean>

	<bean id="hibernateTemplate" class="org.springframework.orm.hibernate3.HibernateTemplate">
		<property name="sessionFactory" ref="hibernateSessionFactory" />
	</bean>

	<bean id="transactionManager" class="org.springframework.orm.hibernate3.HibernateTransactionManager">
		<property name="sessionFactory" ref="hibernateSessionFactory" />
	</bean>

	<bean id="transactionTemplate" class="org.springframework.transaction.support.TransactionTemplate">
		<property name="transactionManager" ref="transactionManager" />
	</bean>

	<!--
		Hibernate root action beans.
	-->
	<bean abstract="true" id="abstractHibernateBackAction" parent="abstractBackAction"
		class="com.d2s.framework.application.backend.action.persistence.hibernate.AbstractHibernateAction">
		<property name="hibernateTemplate" ref="hibernateTemplate" />
		<property name="transactionTemplate" ref="transactionTemplate" />
	</bean>

	<bean id="queryEntitiesBackAction" parent="abstractHibernateBackAction"
		class="com.d2s.framework.application.backend.action.persistence.hibernate.QueryEntitiesAction">
	</bean>
</beans>

