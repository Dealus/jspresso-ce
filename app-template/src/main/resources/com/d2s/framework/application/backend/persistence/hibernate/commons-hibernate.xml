<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN//EN" "http://www.springframework.org/dtd/spring-beans.dtd">

<!--
	Hibernate root application context for the D2S framework.
-->
<beans default-lazy-init="true">

	<!--
		Hibernate persisters configuration. They are configured with basicEntityFactory since this factory is 
		a singleton.
	-->
	<bean class="org.springframework.beans.factory.config.MethodInvokingFactoryBean">
		<property name="targetClass"
			value="com.d2s.framework.model.persistence.hibernate.entity.persister.EntityProxySingleTableEntityPersister" />
		<property name="targetMethod">
			<value>setEntityFactory</value>
		</property>
		<property name="arguments">
			<list>
				<ref bean="basicEntityFactory" />
			</list>
		</property>
	</bean>

	<bean class="org.springframework.beans.factory.config.MethodInvokingFactoryBean">
		<property name="targetClass"
			value="com.d2s.framework.model.persistence.hibernate.entity.persister.EntityProxyJoinedSubclassEntityPersister" />
		<property name="targetMethod">
			<value>setEntityFactory</value>
		</property>
		<property name="arguments">
			<list>
				<ref bean="basicEntityFactory" />
			</list>
		</property>
	</bean>

	<bean class="org.springframework.beans.factory.config.MethodInvokingFactoryBean">
		<property name="targetClass"
			value="com.d2s.framework.model.persistence.hibernate.entity.persister.EntityProxyUnionSubclassEntityPersister" />
		<property name="targetMethod">
			<value>setEntityFactory</value>
		</property>
		<property name="arguments">
			<list>
				<ref bean="basicEntityFactory" />
			</list>
		</property>
	</bean>

	<bean id="abstractHibernateSessionFactory" class="org.springframework.orm.hibernate3.LocalSessionFactoryBean">
		<property name="dataSource" ref="dataSource" />
	</bean>

	<bean id="transactionManager" class="org.springframework.orm.hibernate3.HibernateTransactionManager">
		<property name="sessionFactory" ref="hibernateSessionFactory" />
	</bean>

	<bean id="transactionTemplate" class="org.springframework.transaction.support.TransactionTemplate">
		<property name="transactionManager" ref="transactionManager" />
	</bean>

	<bean id="hibernateTemplate" class="org.springframework.orm.hibernate3.HibernateTemplate" singleton="false">
		<property name="sessionFactory" ref="hibernateSessionFactory" />
	</bean>

	<!--
		Hibernate root action beans.
	-->
	<bean abstract="true" id="abstractHibernateBackAction" parent="abstractBackAction"
		class="com.d2s.framework.application.backend.action.persistence.hibernate.AbstractHibernateAction" />

	<bean id="queryEntitiesBackAction" parent="abstractHibernateBackAction"
		class="com.d2s.framework.application.backend.action.persistence.hibernate.QueryEntitiesAction" />

	<bean abstract="true" id="abstractHibernateBackController" parent="abstractBackController"
		class="com.d2s.framework.application.backend.persistence.hibernate.HibernateBackendController">
		<property name="applicationSession">
			<bean parent="abstractApplicationSession"
				class="com.d2s.framework.application.backend.session.hibernate.HibernateAwareApplicationSession" />
		</property>
		<property name="hibernateTemplate" ref="hibernateTemplate" />
	</bean>
</beans>

