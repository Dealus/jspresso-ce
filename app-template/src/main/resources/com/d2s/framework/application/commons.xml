<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN//EN" "http://www.springframework.org/dtd/spring-beans.dtd">

<!--
	Root application context for the D2S framework.
-->
<beans default-lazy-init="true">
	<!--
		The message source for this context, loaded from localized "messages_xx" files.
		"getMessage" calls to this context will use this source.
		Child contexts can have their own message sources, inheriting all messages from this
		source, being able to define new messages and override ones defined in this source.
	-->
	<bean id="messageSource" class="org.springframework.context.support.ResourceBundleMessageSource">
		<property name="basename" value="messages" />
	</bean>

	<bean id="mockTranslator" class="com.d2s.framework.util.i18n.mock.MockTranslationProvider" />

	<!--
		The implementation used as MvcBinder.
	-->
	<bean id="mvcBinder" class="com.d2s.framework.binding.DefaultMvcBinder"></bean>

	<!--
		The implementation used as AccessorFactory.
	-->
	<bean id="accessorFactory" class="com.d2s.framework.util.bean.DefaultAccessorFactory"></bean>

	<!--
		The implementation used as ConnectorFactory.
	-->
	<bean id="connectorFactory" class="com.d2s.framework.binding.basic.BasicConnectorFactory"></bean>

	<!--
		The implementation used as EntityCollectionFactory.
	-->
	<bean id="entityCollectionFactory" class="com.d2s.framework.model.entity.DefaultEntityCollectionFactory"></bean>

	<!--
		The implementation used as EntityExtensionFactory.
	-->
	<bean id="entityExtensionFactory" class="com.d2s.framework.model.entity.DefaultEntityExtensionFactory"></bean>

	<!--
		The implementation used as BeanConnectorFactory.
	-->
	<bean id="beanConnectorFactory" class="com.d2s.framework.binding.bean.DefaultBeanConnectorFactory">
		<property name="accessorFactory" ref="accessorFactory" />
	</bean>

	<!--
		The implementation used as MvcBinder.
	-->
	<bean id="masterDetailBinder" class="com.d2s.framework.binding.masterdetail.DefaultMasterDetailBinder">
		<property name="mvcBinder" ref="mvcBinder" />
	</bean>

	<!--
		The GUID generator used to implement entities "synthetic key". The idea was
		taken from 'maulinshah' post on the hibernate wiki. The implementation of
		the GUID generator has been written by Marc A. Mnich who published
		it on http://www.javaexchange.com/aboutRandomGUID.html
	-->
	<bean id="entityGUIDGenerator" class="com.d2s.framework.util.uid.RandomGUIDGenerator" />

	<!--
		The root abstract implementation used as Application Session.
	-->
	<bean id="abstractApplicationSession" abstract="true" singleton="false">
		<property name="collectionFactory" ref="entityCollectionFactory" />
		<property name="entityRegistry">
			<bean class="com.d2s.framework.model.entity.basic.BasicEntityRegistry" />
		</property>
		<property name="unitOfWork">
			<bean class="com.d2s.framework.application.backend.session.basic.BasicEntityUnitOfWork" />
		</property>
	</bean>

	<!--
		The implementation used as EntityFactory.
	-->
	<bean id="basicEntityFactory" class="com.d2s.framework.model.entity.basic.BasicProxyEntityFactory">
		<property name="accessorFactory" ref="accessorFactory" />
		<property name="entityCollectionFactory" ref="entityCollectionFactory" />
		<property name="entityExtensionFactory" ref="entityExtensionFactory" />
		<property name="entityGUIDGenerator" ref="entityGUIDGenerator" />
	</bean>

	<bean id="entityFactory" parent="basicEntityFactory"
		class="com.d2s.framework.application.backend.entity.ApplicationSessionAwareProxyEntityFactory" singleton="false">
		<property name="applicationSession" ref="applicationSession" />
	</bean>

	<!--
		Root action beans.
	-->
	<bean abstract="true" id="abstractBackAction"
		class="com.d2s.framework.application.backend.action.AbstractBackendAction" />

	<bean id="createQueryEntityAction" parent="abstractBackAction"
		class="com.d2s.framework.application.backend.action.CreateQueryEntityAction">
	</bean>

	<!--
		The implementation used as view factory.
		View factory is not defined as singleton since it can implement some cache a the session level.
	-->
	<bean id="abstractViewFactory" abstract="true" singleton="false">
		<property name="connectorFactory" ref="connectorFactory" />
		<property name="mvcBinder" ref="mvcBinder" />
		<property name="labelTranslator" ref="mockTranslator" />
		<property name="descriptionTranslator" ref="mockTranslator" />
		<property name="enumerationTranslator" ref="mockTranslator" />
		<property name="masterDetailBinder" ref="masterDetailBinder" />
		<property name="listSelectionModelBinder" ref="listSelectionModelBinder" />
		<property name="treeSelectionModelBinder" ref="treeSelectionModelBinder" />
		<property name="iconFactory" ref="iconFactory" />
		<property name="actionFactory" ref="actionFactory" />
		<property name="lovAction" ref="lovAction" />
		<property name="chooseFileAsBinaryPropertyAction" ref="chooseFileAsBinaryPropertyAction" />
	</bean>

	<bean id="abstractActionFactory" abstract="true" singleton="false">
		<property name="labelTranslator" ref="mockTranslator" />
		<property name="descriptionTranslator" ref="mockTranslator" />
		<property name="iconFactory" ref="iconFactory" />
	</bean>

	<!--
		The scriptHandler.
	-->
	<bean id="scriptHandler" class="com.d2s.framework.util.scripting.DefaultScriptHandler"></bean>

	<!--
		The controllers.
	-->

	<!--
		The controllers. Controllers are not singleton since they can hold some session state.
	-->
	<bean abstract="true" id="abstractFrontController" singleton="false">
		<property name="mvcBinder" ref="mvcBinder" />
		<property name="labelTranslator" ref="mockTranslator" />
		<property name="descriptionTranslator" ref="mockTranslator" />
		<property name="viewFactory" ref="viewFactory" />
		<property name="modulesMenuIconImageUrl" value="classpath:images/modules-48x48.png" />
	</bean>

	<bean abstract="true" id="abstractBackController"
		class="com.d2s.framework.application.backend.DefaultBackendController" singleton="false">
		<property name="entityFactory" ref="entityFactory" />
		<property name="accessorFactory" ref="accessorFactory" />
		<property name="beanConnectorFactory" ref="beanConnectorFactory" />
		<property name="applicationSession" ref="applicationSession" />
	</bean>

	<!--
		The Root descriptor of all entities.
	-->
	<bean id="com.d2s.framework.model.entity.IEntity"
		class="com.d2s.framework.model.descriptor.basic.BasicComponentDescriptor">
		<constructor-arg index="0" value="com.d2s.framework.model.entity.IEntity" />
		<property name="propertyDescriptors">
			<list>
				<bean class="com.d2s.framework.model.descriptor.basic.BasicStringPropertyDescriptor">
					<property name="name" value="id" />
					<property name="mandatory" value="true" />
				</bean>
				<bean class="com.d2s.framework.model.descriptor.basic.BasicIntegerPropertyDescriptor">
					<property name="name" value="version" />
					<property name="mandatory" value="true" />
				</bean>
			</list>
		</property>
	</bean>

	<!--
		Utility beans for model.
	-->
	<bean id="DATE" class="org.springframework.beans.factory.config.FieldRetrievingFactoryBean">
		<property name="staticField">
			<value>com.d2s.framework.model.descriptor.IDatePropertyDescriptor.DATE_TYPE</value>
		</property>
	</bean>
	<bean id="TIME" class="org.springframework.beans.factory.config.FieldRetrievingFactoryBean">
		<property name="staticField">
			<value>com.d2s.framework.model.descriptor.IDatePropertyDescriptor.TIME_TYPE</value>
		</property>
	</bean>
	<bean id="DATE_TIME" class="org.springframework.beans.factory.config.FieldRetrievingFactoryBean">
		<property name="staticField">
			<value>com.d2s.framework.model.descriptor.IDatePropertyDescriptor.DATE_TIME_TYPE</value>
		</property>
	</bean>

	<!--
		Utility beans for views.
	-->
	<bean id="ASIDE" class="org.springframework.beans.factory.config.FieldRetrievingFactoryBean">
		<property name="staticField">
			<value>com.d2s.framework.view.descriptor.IComponentViewDescriptor.ASIDE</value>
		</property>
	</bean>
	<bean id="ABOVE" class="org.springframework.beans.factory.config.FieldRetrievingFactoryBean">
		<property name="staticField">
			<value>com.d2s.framework.view.descriptor.IComponentViewDescriptor.ABOVE</value>
		</property>
	</bean>
	<bean id="ROW" class="org.springframework.beans.factory.config.FieldRetrievingFactoryBean">
		<property name="staticField">
			<value>com.d2s.framework.view.descriptor.IEvenGridViewDescriptor.ROW</value>
		</property>
	</bean>
	<bean id="COLUMN" class="org.springframework.beans.factory.config.FieldRetrievingFactoryBean">
		<property name="staticField">
			<value>com.d2s.framework.view.descriptor.IEvenGridViewDescriptor.COLUMN</value>
		</property>
	</bean>
	<bean id="HORIZONTAL" class="org.springframework.beans.factory.config.FieldRetrievingFactoryBean">
		<property name="staticField">
			<value>com.d2s.framework.view.descriptor.ISplitViewDescriptor.HORIZONTAL</value>
		</property>
	</bean>
	<bean id="VERTICAL" class="org.springframework.beans.factory.config.FieldRetrievingFactoryBean">
		<property name="staticField">
			<value>com.d2s.framework.view.descriptor.ISplitViewDescriptor.VERTICAL</value>
		</property>
	</bean>
	<bean id="SIMPLE_BORDER" class="org.springframework.beans.factory.config.FieldRetrievingFactoryBean">
		<property name="staticField">
			<value>com.d2s.framework.view.descriptor.IViewDescriptor.SIMPLE</value>
		</property>
	</bean>
	<bean id="TITLED_BORDER" class="org.springframework.beans.factory.config.FieldRetrievingFactoryBean">
		<property name="staticField">
			<value>com.d2s.framework.view.descriptor.IViewDescriptor.TITLED</value>
		</property>
	</bean>
	<bean id="decoratedView" abstract="true">
		<property name="borderType" ref="TITLED_BORDER" />
	</bean>

	<!--
		Module utility beans.
	-->
	<bean id="moduleDescriptor" class="com.d2s.framework.application.model.descriptor.ModuleDescriptor" />
	<bean id="subModulesPropertyDescriptor"
		class="org.springframework.beans.factory.config.MethodInvokingFactoryBean">
		<property name="targetObject" ref="moduleDescriptor" />
		<property name="targetMethod" value="getPropertyDescriptor" />
		<property name="arguments">
			<list>
				<value>subModules</value>
			</list>
		</property>
	</bean>
	<bean abstract="true" id="abstractSubModulesNodeGroupDescriptor"
		class="com.d2s.framework.view.descriptor.basic.BasicListViewDescriptor">
		<property name="renderedProperty" value="name" />
		<property name="modelDescriptor" ref="subModulesPropertyDescriptor" />
	</bean>
</beans>